$(function(){function e(){var e=$("#searchResults").html(),t=Handlebars.compile(e)
$("#wikiInfo").html(t(f))}function t(){$("#wikiInfo").html(""),$(".searchbox").val(""),$(".searchInput").css("top","50%"),$("#wikiInfo").css("opacity","0"),$(".input-group").css("opacity","1"),d="",g=!1}function a(e){$("[id^=flipper]").map(function(t){t!=e&&$("#flipper"+t).turn("page",1)})}function n(e,t,n){if(2==t){a(e)
var i=n.querySelectorAll("img")[0]
i.src.indexOf("#")>=0?n.querySelectorAll("img")[1].className="loading setVisible":n.querySelectorAll("img")[1].className="loading loaded",$.getJSON("./functions.php?img="+i.dataset.imagetitle,function(e){var t=Object.keys(e.query.pages)[0],a="",r="appear landscape"
try{a=e.query.pages[t].imageinfo[0].thumburl,e.query.pages[t].imageinfo[0].height>e.query.pages[t].imageinfo[0].width&&(r="appear portrait")}catch(e){a="public/images/cat.png"}i.src=a,n.querySelectorAll("img")[1].className="loading loaded",i.className=i.className+" "+r})}}function i(){s(),$("[id^=flipper]").map(function(e){$("#flipper"+e).turn({when:{turning:function(t,a,i){var r=this
n(e,a,r)}},width:490,height:290,autoCenter:!0,duration:800})})}function r(t){$.getJSON("./functions.php?search="+t+"&lang="+u,function(t){f=t,$("#wikiInfo").animate({scrollTop:0},1e3),e(),i(),$("#flipper0").turn("page",2)})}function s(){$(".searchInput").css({top:"7%",left:"10px"}),$("#wikiInfo").css("opacity","1")}function l(e){return!isNaN(parseFloat(e))&&isFinite(e)}function c(e){$.each($(e),function(e,t){var a=t.innerHTML.trim()
t.dataset.value&&(a=t.dataset.value),l(a)||$.getJSON("./functions.php?text="+encodeURIComponent(a)+"&lang=en-"+u,function(e){"true"==t.dataset.isq?t.innerHTML='<a href="http://translate.yandex.com/" target="_blank"> Powered by Yandex.Translate</a><br/>'+e.text[0]:t.innerHTML=e.text[0]})})}function o(){g=!0,s(),$("#wikiInfo").html(""),$(".loader").toggleClass("show"),$.getJSON("./functions.php?trivia=true&num=3",function(e){$(".loader").toggleClass("show")
var t=$("#randomResults").html(),a=Handlebars.compile(t),n=Array.apply(null,Array(3)).map(function(t,a){return{lang:u,question:decodeURIComponent(e[a].question),choices:e[a].choices.map(function(e){return decodeURIComponent(e)}),category:e[a].category}}),i={wikis:n}
$("#wikiInfo").html(a(i)),"en"!=u&&c(".translate"),$(".lock").hover(function(){$(this).toggleClass("fa-unlock-alt")}),$(".lock").on("click",function(e){$(".overlay[data-answered='false']").removeClass("visible"),$(e.target).parent().toggleClass("visible")}),$("#wikiInfo").on("click",function(e){$(e.target).closest("div").is(".card-container")||$(e.target).closest("div").is(".overlay")||$(".overlay[data-answered='false']").removeClass("visible")}),$(".unlock").on("click",function(e){e.preventDefault()
var t=this.parentElement.querySelectorAll("input[name='answer']:checked")[0],a=this
t?$.getJSON("./functions.php?checkTrivia=true&triviaAnswer="+t.value+"&triviaId="+this.parentElement.dataset.triviaid,function(e){if(a.parentElement.parentElement.querySelectorAll(".overlay")[0].dataset.answered=!0,"correct"==e){var n="https://"+u+".wikipedia.org/wiki/Special:RandomInCategory/"+a.parentElement.dataset.category
$(a.parentElement).html('<p class="final success translate">'+t.value+' is correct <br> <a href="'+n+'" target="_blank"> See Wiki '+a.parentElement.dataset.category+"</a></p>")}else $(a.parentElement).html('<p class="final wrong translate">Nope! The answer is <br> '+e+"</p>")
c(".final")}):alert("Nothing is checked!")})})}var u="",p="",g=!1,d="",f="",h=["en","fr","ru","sv","ja","ro","it","es"]
$(".searchbox").autocomplete({source:function(e,t){jQuery.getJSON("./functions.php?autocomplete=true&q="+e.term+"&lang="+u,function(e){t(e),g=!1})},minLength:3,select:function(e,t){return d=t.item.value,$(".searchbox").val(d),r(d),g=!1,!1}}),$(document).ready(function(){function a(e){var t="",a=e.split(" "),n="extract"
if(a.length<=20)return'<div class="extract firstE">'+e+"</div></div>"
for(var i=20,r=0;r<=a.length;r+=i){if(0!==r?t+="<div>":n+=" firstE",t+='<div class="'+n+'">'+a.slice(r,i).join(" ")+"</div></div>",!(i+40<a.length))return t+='<div></div><div><div class="extract">'+a.slice(i).join(" ")+"</div></div>"
i+=20}return t}$(".searchbox").keyup(function(e){13==e.keyCode&&(r(e.currentTarget.value),$(this).autocomplete("close"),g=!1)}),u=navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage,h.indexOf(u)>=0?$("#"+u).addClass("active"):(u="en",$("#"+u).addClass("active")),$("#randomWikis").click(function(e){o(),g=!0,$(".input-group").css("opacity","0")}),$("#searchWiki").click(function(e){t()}),$("#refresh").click(function(e){t()}),$(".languages li > a").click(function(e){u=e.currentTarget.id,p=$(".languages a.active")[0].id,$(".languages a").removeClass("active"),$(this).addClass("active"),g?c(".translate"):""!==d&&r(d)}),Handlebars.registerHelper("addShelf",function(e,t){var a=$(window).width()<1286?1:2
return e%a==0&&0!==e?t.fn(this):t.inverse(this)}),Handlebars.registerHelper("applyClass",function(e){return e.length>30?new Handlebars.SafeString('<h4 class="longTitle">'+e+"</h4>"):new Handlebars.SafeString('<h4 class="shortTitle">'+e+"</h4>")}),Handlebars.registerHelper("splitInPages",function(e,t){var n='<div> <a class="linkT" href="https://'+u+".wikipedia.org/wiki/"+e+'" target="_blank"> <div class="positionT"><h4 class="articleTitle">'+e+"</h4></div></a>"
return new Handlebars.SafeString(n+a(t))}),Handlebars.registerHelper("getLang",function(){return u}),enquire.register("screen and (max-width: 1290px)",{match:function(){g||""==d||(e(),i())},unmatch:function(){g||""==d||(e(),i())}})})})
